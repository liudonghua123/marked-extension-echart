<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marked ECharts Extension Demo</title>
    <!-- Basic styles -->
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; }
    </style>
    <!-- Import Maps for modules -->
    <script type="importmap">
    {
        "imports": {
            "echarts": "https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.esm.min.js",
            "marked": "https://cdn.jsdelivr.net/npm/marked@12.0.0/lib/marked.esm.js"
        }
    }
    </script>
    <!-- ECharts needs to be globally available for the inline script to find it easy by default if using non-module script, 
         but our inline script uses window.echarts. 
         Since we use module import, we need to expose it to window. -->
</head>
<body>
    <h1>Marked ECharts Extension Demo</h1>
    <div id="content"></div>

    <script type="module">
        import { marked } from 'marked';
        import * as echarts from 'echarts';
        import markedECharts from './src/index.js';

        // Expose echarts to window for the inline scripts generated by the extension
        window.echarts = echarts;

        // Use the extension
        marked.use(markedECharts());

        const markdown = `
## Bar Chart Example

\`\`\`echarts
{
  xAxis: {
    type: 'category',
    data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
  },
  yAxis: {
    type: 'value'
  },
  series: [
    {
      data: [120, 200, 150, 80, 70, 110, 130],
      type: 'bar'
    }
  ]
}
\`\`\`

## Pie Chart Example

\`\`\`echarts
{
  title: {
    text: 'Referer of a Website',
    subtext: 'Fake Data',
    left: 'center'
  },
  tooltip: {
    trigger: 'item'
  },
  legend: {
    orient: 'vertical',
    left: 'left'
  },
  series: [
    {
      name: 'Access From',
      type: 'pie',
      radius: '50%',
      data: [
        { value: 1048, name: 'Search Engine' },
        { value: 735, name: 'Direct' },
        { value: 580, name: 'Email' },
        { value: 484, name: 'Union Ads' },
        { value: 300, name: 'Video Ads' }
      ],
      emphasis: {
        itemStyle: {
          shadowBlur: 10,
          shadowOffsetX: 0,
          shadowColor: 'rgba(0, 0, 0, 0.5)'
        }
      }
    }
  ]
}
\`\`\`
        `;

        document.getElementById('content').innerHTML = marked.parse(markdown);
        
        // Execute the scripts inserted by marked
        // Note: innerHTML does not execute scripts. We need to manually execute them.
        // However, standard marked usage often involves this issue.
        // The extension approach using inline script tags relies on the browser executing them?
        // No, invalid assumption. innerHTML does NOT execute scripts.
        // We need a helper to execute the scripts or hydration logic.
        
        // Let's implement a simple script executor for the demo
        const scripts = document.getElementById('content').querySelectorAll('script');
        scripts.forEach(script => {
           const newScript = document.createElement('script');
           newScript.textContent = script.textContent;
           document.body.appendChild(newScript);
        });

    </script>
</body>
</html>
